# RAG Chatbot

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π Retrieval-Augmented Generation —Å—Ç–µ–∫: FastAPI‚Äë–±—ç–∫–µ–Ω–¥ —Å Celery‚Äë–≤–æ—Ä–∫–µ—Ä–æ–º –∏ Qdrant, —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–∞ React/Vite –∏ docker-compose –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å Ollama, Redis –∏ —Å—Ç–µ–∫–æ–º –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç–∏ (Prometheus + Grafana + Loki). –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –≥–æ—Ç–æ–≤—É—é —Å—Ç–∞—Ä—Ç–æ–≤—É—é –ø–ª–æ—â–∞–¥–∫—É –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤ –∏ —á–∞—Ç‚Äë–±–æ—Ç–æ–≤ –ø–æ–≤–µ—Ä—Ö –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π.

## –ö—Ä–∞—Ç–∫–æ

- üß† **–ë—ç–∫–µ–Ω–¥ FastAPI + Celery**: ingestion, —á–∞—Ç, –≥–∏–±—Ä–∏–¥–Ω—ã–π —Ä–µ—Ç—Ä–∏–≤–µ—Ä, –ø—Ä–æ–º–ø—Ç—ã –∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –≤–æ—Ä–∫–µ—Ä –¥–ª—è —Ç—è–∂—ë–ª—ã—Ö –∑–∞–¥–∞—á.
- üìö **–¶–µ–ø–æ—á–∫–∞ RAG**: Markdown‚Äë–æ—Å–≤–µ–¥–æ–º–ª—ë–Ω–Ω—ã–π —Å–ø–ª–∏—Ç—Ç–µ—Ä, docstore –Ω–∞ –¥–∏—Å–∫–µ, —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ SentenceTransformers –∏ Qdrant –≤–µ–∫—Ç–æ—Ä–∫–∞.
- üí¨ **–§—Ä–æ–Ω—Ç–µ–Ω–¥ Vite/React**: –≤–∫–ª–∞–¥–∫–∏ Chat/Upload, localStorage –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞, –ø—Ä–æ–≥—Ä–µ—Å—Å‚Äë–±–∞—Ä –∑–∞–≥—Ä—É–∑–∫–∏.
- üì¶ **Docker-compose –æ–∫—Ä—É–∂–µ–Ω–∏–µ**: API, –≤–æ—Ä–∫–µ—Ä, —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥, Redis, Qdrant, Ollama, Prometheus, Grafana –∏ Loki –ø–æ–¥–Ω–∏–º–∞—é—Ç—Å—è –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π.
- üõ°Ô∏è **–ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É**: CORS, –º–µ—Ç—Ä–∏–∫–∏ Prometheus, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Loki, –∑–∞–≥–æ—Ç–æ–≤–∫–∏ –ø–æ–¥ JWT –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.** REST‚Äë—ç–Ω–¥–ø–æ–∏–Ω—Ç `/ingest` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã, —Ä–∞–∑–±–∏–≤–∞–µ—Ç –∏—Ö Markdown‚Äë–æ—Å–≤–µ–¥–æ–º–ª—ë–Ω–Ω—ã–º –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–µ —á–∞–Ω–∫–∏ –Ω–∞ –¥–∏—Å–∫ –∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –≤ Qdrant.
- **–î–∏–∞–ª–æ–≥ —Å —Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º.** –≠–Ω–¥–ø–æ–∏–Ω—Ç `/chat` –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—ã–π —Ä–µ—Ç—Ä–∏–≤–µ–ª, rerank, –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã –≤ –ø—Ä–æ–º–ø—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–µ—Ä–≤–æ–∏—Å—Ç–æ—á–Ω–∏–∫–∏.
- **–ì–∏–±–∫–∞—è –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è.** –í—Å–µ —Ç—è–∂—ë–ª—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –ª–µ–Ω–∏–≤–æ: —Å–µ—Ä–≤–∏—Å —Å—Ç–∞—Ä—Ç—É–µ—Ç –¥–∞–∂–µ –±–µ–∑ —Å–∫–∞—á–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π, –∞ –æ—à–∏–±–∫–∏ –≤ reranker'–µ –Ω–µ –ª–æ–º–∞—é—Ç —á–∞—Ç.
- **–ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å.** API –∏ Celery‚Äë–≤–æ—Ä–∫–µ—Ä —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç –º–µ—Ç—Ä–∏–∫–∏ Prometheus, docker-compose –ø–æ–¥–Ω–∏–º–∞–µ—Ç Grafana –∏ Loki –¥–ª—è –¥–∞—à–±–æ—Ä–¥–æ–≤ –∏ –ª–æ–≥–æ–≤.
- **UI –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.** –ü—Ä–æ—Å—Ç–æ–µ Vite‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –≤–∫–ª–∞–¥–∫–∞–º–∏ ¬´Chat/Upload¬ª, –∏—Å—Ç–æ—Ä–∏–µ–π –¥–∏–∞–ª–æ–≥–æ–≤ –≤ localStorage –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å‚Äë–±–∞—Ä–æ–º –∑–∞–≥—Ä—É–∑–æ–∫.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```
.
‚îú‚îÄ‚îÄ backend/              # FastAPI, Celery, —Å–µ—Ä–≤–∏—Å—ã –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ server/api        # –†–æ—É—Ç–µ—Ä—ã /chat, /ingest, /health
‚îÇ   ‚îú‚îÄ‚îÄ server/services   # Embeddings, retriever, vector store, LLM, –ø—Ä–æ–º–ø—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ server/tasks      # Celery worker + –º–µ—Ç—Ä–∏–∫–∏ Prometheus
‚îÇ   ‚îî‚îÄ‚îÄ tests             # Pytest-—ã (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ E2E)
‚îú‚îÄ‚îÄ frontend/             # React/Vite –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å Tailwind
‚îú‚îÄ‚îÄ compose/              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus/Grafana/Loki
‚îú‚îÄ‚îÄ docker-compose.yml    # –ü–æ–ª–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (API, worker, frontend, Qdrant‚Ä¶)
‚îú‚îÄ‚îÄ Makefile              # –®–æ—Ä—Ç–∫–∞—Ç—ã –¥–ª—è docker compose
‚îú‚îÄ‚îÄ sample.md             # –ü—Ä–∏–º–µ—Ä –≤—Ö–æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞
‚îî‚îÄ‚îÄ README.md
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker 24+ –∏ docker compose plugin
- Make 4.x (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ —É–ø—Ä–æ—â–∞–µ—Ç –∑–∞–ø—É—Å–∫)
- Node.js 20 (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –≤–Ω–µ Docker)
- Python 3.11 (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤/—Ç–µ—Å—Ç–æ–≤ backend –±–µ–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤)

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (docker-compose)

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   ```bash
   cp .env.example .env  # —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
   ```
   –ï—Å–ª–∏ `.env.example` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞–π—Ç–µ `.env` –≤—Ä—É—á–Ω—É—é (—Å–º. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)).
2. –ü–æ–¥–Ω–∏–º–∏—Ç–µ –±–∞–∑–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã –∏ —Å–∫–∞—á–∞–π—Ç–µ –º–æ–¥–µ–ª—å Ollama:
   ```bash
   make base              # qdrant + redis + ollama
   make pull-model        # —Å–∫–∞—á–∞–µ—Ç qwen2.5:3b –≤ Ollama
   ```
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (API, worker, frontend, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥):
   ```bash
   make up
   ```
4. –û—Ç–∫—Ä–æ–π—Ç–µ UI: <http://localhost:5173>. API –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ <http://localhost:8010>, Prometheus ‚Äî <http://localhost:9090>, Grafana ‚Äî <http://localhost:3000>, Loki ‚Äî <http://localhost:3100>.
5. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ: `make down`.

> –ö–æ–º–∞–Ω–¥—ã `make up` –∏ `make down` –ø—Ä–æ–∫—Å–∏—Ä—É—é—Ç `docker compose up/down`. –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å `docker compose up --build` –Ω–∞–ø—Ä—è–º—É—é, –µ—Å–ª–∏ make –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.

## –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ Docker

### Backend (FastAPI + Celery)

```bash
cd backend
python -m venv .venv && source .venv/bin/activate
pip install -r requirements.txt
uvicorn server.main:app --reload --port 8000
```

–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ Celery‚Äë–≤–æ—Ä–∫–µ—Ä:

```bash
celery -A server.tasks.worker.app worker -l info
```

> –í–∞–º –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã Redis –∏ Qdrant. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏–∑ `docker-compose` (`docker compose up qdrant redis`) –ª–∏–±–æ —É–ø—Ä–∞–≤–ª—è–µ–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã.

### Frontend (React/Vite)

```bash
cd frontend
npm install
npm run dev -- --host 0.0.0.0 --port 5173
```

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ API‚Äë–±–∞–∑—ã –±–µ—Ä—É—Ç—Å—è –∏–∑ `frontend/.env` –∏–ª–∏ `VITE_API_BASE_URL` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `http://localhost:8010`).

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

Backend —á–∏—Ç–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ `backend/server/core/config.py`. –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|------------|------------------------|
| `ENV` | —Ä–µ–∂–∏–º (`dev`/`prod`) | `dev` |
| `API_HOST`, `API_PORT` | –∞–¥—Ä–µ—Å FastAPI | `0.0.0.0`, `8000` |
| `CORS_ORIGINS` | —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ Origin-—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é) | `http://localhost:5173` |
| `MAX_UPLOAD_MB` | –ª–∏–º–∏—Ç —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (MB) | `25` |
| `JWT_SECRET`, `JWT_EXPIRES_MIN` | –∑–∞–≥–æ—Ç–æ–≤–∫–∞ –ø–æ–¥ JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é | `change_me`, `60` |
| `LLM_PROVIDER`, `LLM_MODEL` | –∏—Å—Ç–æ—á–Ω–∏–∫ –∏ –º–æ–¥–µ–ª—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (Ollama/OpenAI/HF) | `ollama`, `qwen2.5:3b` |
| `OLLAMA_HOST` | –∞–¥—Ä–µ—Å Ollama API | `http://ollama:11434` |
| `OPENAI_API_KEY`, `HF_API_TOKEN` | –∫–ª—é—á–∏ –¥–ª—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö LLM | –ø—É—Å—Ç–æ |
| `EMBED_PROVIDER`, `EMBED_MODEL`, `EMBED_DIM` | –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ | `sbert`, `sentence-transformers/all-MiniLM-L6-v2`, `384` |
| `VECTOR_BACKEND`, `QDRANT_URL`, `QDRANT_COLLECTION` | –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ | `qdrant`, `http://qdrant:6333`, `kb` |
| `DB_URL` | URL –±–∞–∑—ã SQLAlchemy (doc metadata) | `sqlite+aiosqlite:///./data/app.db` |
| `DOCSTORE_PATH` | —Ñ–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —á–∞–Ω–∫–æ–≤ | `./data/chunks` |
| `REDIS_URL` | –±—Ä–æ–∫–µ—Ä –¥–ª—è Celery | `redis://redis:6379/0` |
| `PROMETHEUS_ENABLED`, `API_METRICS_PATH`, `WORKER_METRICS_PORT` | –º–µ—Ç—Ä–∏–∫–∏ API/worker | `True`, `/metrics`, `8001` |

–°–æ–∑–¥–∞–π—Ç–µ `.env` –Ω–∞ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –Ω—É–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.

## API

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| `GET /health` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ—Å—Ç–∞–º–∏ –∏ Prometheus). |
| `POST /ingest` | Multipart‚Äë–∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ (`file`). –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `document_id`, `document_hash`, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞–Ω–∫–æ–≤. |
| `POST /chat` | –¢–µ–ª–æ `{ "question": string }`. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `answer` –∏ –º–∞—Å—Å–∏–≤ `references` (id –¥–æ–∫—É–º–µ–Ω—Ç–∞, –∏–º—è —Ñ–∞–π–ª–∞, –ø—Ä–µ–≤—å—é, —Å—á—ë—Ç). |
| `GET /metrics` | –ú–µ—Ç—Ä–∏–∫–∏ Prometheus FastAPI‚Äë–ø—Ä–æ—Ü–µ—Å—Å–∞ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ). |
| `GET /admin/reindex` | –ó–∞–≥–ª—É—à–∫–∞ (–≤ –ø–ª–∞–Ω–∞—Ö –ø–æ–ª–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π API). |

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger/OpenAPI –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É <http://localhost:8010/docs>.

## –ü–æ—Ç–æ–∫ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –∏ –ø–æ–∏—Å–∫–∞

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª —á–µ—Ä–µ–∑ UI –∏–ª–∏ `POST /ingest`.
2. `split_with_metadata` —Ä–µ–∂–µ—Ç —Ç–µ–∫—Å—Ç –Ω–∞ —á–∞–Ω–∫–∏ (Markdown‚Äë–æ—Å–≤–µ–¥–æ–º–ª—ë–Ω–Ω—ã–µ, 800 —Å–∏–º–≤–æ–ª–æ–≤, overlap 120) –∏ –æ–±–æ–≥–∞—â–∞–µ—Ç –∏—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏.
3. Docstore (`backend/data/chunks`) —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç, —á—Ç–æ–±—ã —á–∞—Ç –º–æ–≥ –≤—ã—Ç–∞—Å–∫–∏–≤–∞—Ç—å –ø—Ä–µ–≤—å—é.
4. `Indexer` –ø–æ–ª—É—á–∞–µ—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ (SentenceTransformers) –∏ –∞–ø—Å–µ—Ä—Ç–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ Qdrant.
5. –í–æ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞ `/chat` `HybridRetriever` –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–∏–º–≤–æ–ª—å–Ω—ã–π –∏ –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫, reranker (CrossEncoder) —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –∏ –≤ –ø—Ä–æ–º–ø—Ç –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –º–∞–∫—Å–∏–º—É–º 6 –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤.
6. `get_llm()` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–∑—ã–≤–∞–µ—Ç Ollama (Qwen2.5 3B) –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç –≤–º–µ—Å—Ç–µ —Å —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏.

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

- **Prometheus** —Å–æ–±–∏—Ä–∞–µ—Ç `/metrics` –∏–∑ API –∏ HTTP‚Äë—Å–µ—Ä–≤–µ—Ä –≤–æ—Ä–∫–µ—Ä–∞ (`WORKER_METRICS_PORT`).
- **Grafana** –ø—Ä–µ–¥–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö Prometheus –∏ Loki (–¥–∞—à–±–æ—Ä–¥—ã –≤ `compose/grafana`).
- **Loki** —Å–æ–±–∏—Ä–∞–µ—Ç stdout/stderr –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ docker-compose, –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫ Grafana Explore.

## –¢–µ—Å—Ç—ã

Backend –ø–æ–∫—Ä—ã—Ç pytest‚Äë–∞–º–∏ –¥–ª—è ingestion, –ø–æ–∏—Å–∫–∞ –∏ E2E‚Äë—Ü–µ–ø–æ—á–∫–∏ ¬´–∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª ‚Üí –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç —Å —Å—Å—ã–ª–∫–∞–º–∏¬ª. –ó–∞–ø—É—Å–∫:

```bash
cd backend
pytest
```

## CI/CD

GitHub Actions (—Ñ–∞–π–ª [`.github/workflows/ci.yml`](.github/workflows/ci.yml)) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ push –∏ pull request –≤ `main` –∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á:

- **Backend lint & tests.** –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç Python¬†3.11, —Å—Ç–∞–≤–∏—Ç `backend/requirements.txt`, –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç `ruff check backend scripts`, `mypy backend/server` –∏ `pytest backend/tests`, —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∏–ª—å, —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é —Ç–∏–ø–∏–∑–∞—Ü–∏—é –∏ –∑–µ–ª—ë–Ω—ã–µ —Ç–µ—Å—Ç—ã.
- **Frontend build.** –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç Node.js¬†20, –≤—ã–ø–æ–ª–Ω—è–µ—Ç `npm ci` –∏ `npm run build` –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `frontend`, –ø—Ä–æ–≤–µ—Ä—è—è, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å —É—Å–ø–µ—à–Ω–æ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è.

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã

- –î–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `sample.md` / `test.md` ‚Äî —ç—Ç–æ –≥–æ—Ç–æ–≤—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏.
- –õ–æ–≥–∏ Celery –∏ API –ª–µ–≥–∫–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á–µ—Ä–µ–∑ `make logs`.
- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–º–µ–Ω–∏—Ç—å –º–æ–¥–µ–ª—å Ollama, –æ–±–Ω–æ–≤–∏—Ç–µ `LLM_MODEL` –≤ `.env` –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `curl -X POST http://localhost:11434/api/pull -d '{"name":"<model>"}'`.
- –ó–Ω–∞—á–µ–Ω–∏–µ `MAX_UPLOAD_MB` –ø–æ–∫–∞ –Ω–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –Ω–æ UI –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø—Ä–æ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤.

